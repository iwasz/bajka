<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" 
        "file:///home/iwasz/program/projects/tiliae/base/container/tiliae-container-1.0.dtd">

<beans>

    <!--Definicja obrazka. Jest tu M, V i C, gotowe do użycia. Z tej-->
    <!--definicji należy dziedziczyć (parent) i ustawiać model.path i-->
    <!--na przykłąd model.translatePont.-->
    <bean id="image" class="SimpleController" init-method="init">
        
        <!--Model-->
        <property name="model" ref="imageModel">
            <bean id="imageModel" class="Model::Image" scope="bean">
                <property name="path" value="../gfx/main02.png" />
                <property name="move">
                    <bean class="Point">
                        <property name="x"><value type="double">-512.0</value></property>
                        <property name="y"><value type="double">-512.0</value></property>
                    </bean>
                </property>
            </bean>
        </property>

        <!--View-->
        <property name="widget">
            <bean class="View::Image">
                <property name="model" ref="imageModel" />
            </bean>
        </property>
    </bean>



    <!--Uwaga! Ustawiam property "widget.model", ale to jest inny-->
    <!--obiekt niż "model". Kiedy się zaimplementuje scope bean, to-->
    <!--będzie tylko jeden obiekt i ustawienie takie jak poniżej-->
    <!--będzie OK. Teraz path będzie zmieniony tylko w kopii, którą-->
    <!--posiada widget, a w kopii którą posiada kontroler jest stara-->
    <!--ścieżka. TODO.-->
    <bean id="background" parent="image" singleton="true">
        <property name="bitMask"><value type="unsigned int">0</value></property>       
        <property name="model.resizeW"><value type="double">1</value></property>
        <property name="model.resizeH"><value type="double">1</value></property>
    </bean>

    <bean id="background2" parent="image" singleton="true">
        <property name="model.path" value="../gfx/ralervegen.jpg" />
<!--        <property name="model.resizeW"><value type="double">2</value></property>-->
<!--        <property name="model.resizeH"><value type="double">2</value></property>-->
    </bean>



<!-- ===================================================================================== -->



    <bean id="rect" class="SimpleController" init-method="init">

        <!--Model-->
        <property name="model">
            <bean id="model" class="Model::Box" scope="bean">
                <property name="x1"><value type="double">-50</value></property>
                <property name="y1"><value type="double">-50</value></property>
                <property name="x2"><value type="double">50</value></property>
                <property name="y2"><value type="double">50</value></property>

                <property name="rotate"><value type="double">0.7853981</value></property>

                <property name="move">
                    <bean class="Point">
                        <property name="x"><value type="double">50</value></property>
                        <property name="y"><value type="double">50</value></property>
                    </bean>
                </property>

                <property name="resizeW"><value type="double">2</value></property>
                <property name="resizeH"><value type="double">2</value></property>
            </bean>
        </property>

        <!--View-->
        <property name="widget">
            <bean class="Rectangle">
                <property name="model" ref="model"/>
            </bean>
        </property>

        <property name="bitMask"><value type="unsigned int">1</value></property>       
    </bean>



<!-- ===================================================================================== -->
<!--+==============+-->
<!--| Scroll Layer |-->
<!--+==============+-->



    <bean id="scrollEventMargin" class="ScrollMarginController" init-method="init">

        <!--Model-->
        <property name="model">
            <bean id="model" class="Model::Box" scope="bean"/>
        </property>

        <!--View-->
        <property name="widget">
            <bean class="Rectangle">
                <property name="model" ref="model"/>
            </bean>
        </property>

        <!--Tylko event mouse motion-->
        <property name="bitMask"><value type="unsigned int">1</value></property>       
    </bean>



    <bean id="scrollEventMarginLeft" parent="scrollEventMargin">
        <property name="model.x1"><value type="double">-319</value></property>
        <property name="model.y1"><value type="double">-239</value></property>
        <property name="model.x2"><value type="double">-220</value></property>
        <property name="model.y2"><value type="double">240</value></property>
        <property name="type"><value type="int">3</value></property>
    </bean>



    <bean id="scrollEventMarginRight" parent="scrollEventMargin">
        <property name="model.x1"><value type="double">220</value></property>
        <property name="model.y1"><value type="double">-239</value></property>
        <property name="model.x2"><value type="double">320</value></property>
        <property name="model.y2"><value type="double">240</value></property>
        <property name="type"><value type="int">1</value></property>
    </bean>



    <bean id="scrollEventMarginTop" parent="scrollEventMargin">
        <property name="model.x1"><value type="double">-319</value></property>
        <property name="model.y1"><value type="double">140</value></property>
        <property name="model.x2"><value type="double">320</value></property>
        <property name="model.y2"><value type="double">240</value></property>
        <property name="type"><value type="int">0</value></property>
    </bean>
    
    
    
    <bean id="scrollEventMarginBottom" parent="scrollEventMargin">
        <property name="model.x1"><value type="double">-319</value></property>
        <property name="model.y1"><value type="double">-239</value></property>
        <property name="model.x2"><value type="double">320</value></property>
        <property name="model.y2"><value type="double">-140</value></property>
        <property name="type"><value type="int">2</value></property>
    </bean>



    <bean id="scrollMargins" class="SimpleController" init-method="init" singleton="true">
        <property name="children">
            <list class="ControllerList">
                <ref bean="scrollEventMarginLeft"/>                
                <ref bean="scrollEventMarginRight"/>                
                <ref bean="scrollEventMarginTop"/>
                <ref bean="scrollEventMarginBottom"/>
            </list>
        </property>

        <!--Mouse move - jeśli tego nie będzie, to event nie zostanie przekazany do potomków.-->
        <property name="bitMask"><value type="unsigned int">1</value></property>
    </bean>
    
    
    
    <bean id="scrollController" class="ScrollController">
        <property name="model">
            <bean class="ParalaxModel">
                <property name="depths">
                    <list class="DoubleVector">
                        <value type="double">0.5</value>
                        <value type="double">1.0</value>
                    </list>
                </property>
            </bean>
        </property>
    
        <property name="children">
            <list class="ControllerList">
                <ref bean="background2"/>
                <ref bean="background"/>
            </list>
        </property>
    
        <!-- Zegarowy -->
        <property name="bitMask"><value type="unsigned int">8</value></property>
    </bean>
    
<!-- ===================================================================================== -->
<!--+===============+-->
<!--| Paralax stuff |-->
<!--+===============+-->
    
    <bean id="modeltmp1" class="Model::Box" scope="singleton">
        <property name="x1"><value type="double">-50</value></property>
        <property name="y1"><value type="double">-50</value></property>
        <property name="x2"><value type="double">50</value></property>
        <property name="y2"><value type="double">50</value></property>
    </bean>
    
    <bean id="tmp1" class="SimpleController" init-method="init">
        <!--Model-->
        <property name="model" ref="modeltmp1"/>

        <!--View-->
        <property name="widget">
            <bean class="Rectangle">
                <property name="model" ref="modeltmp1"/>
            </bean>
        </property>
    </bean>
    
    
    

    
        
    <bean id="translationMapping" class="TranslationMapping">    
        <property name="model" ref="modeltmp1"/>
<!--        <property name="model" ref="paralaxModel"/>-->
<!--        Tak się nie da, a było by miło... -->
<!--        <property name="model" ref="background.model"/> -->

        <property name="sequence">
            <bean id="seq2" class="ConstSequence&lt;Geometry::Point&gt;">
                <property name="step">
                    <bean class="Point">
                        <property name="x"><value type="double">1</value></property>
                        <property name="y"><value type="double">0</value></property>            
                    </bean>
                </property>
            </bean>
        </property>                
    </bean>
    
    <bean id="ruchJednostajny" class="ObserverWithMapping">
        <property name="mapping" ref="translationMapping" />
        <property name="bitMask"><value type="unsigned int">255</value></property>
    </bean>
    
<!-- ===================================================================================== -->

    <bean id="screen" class="SimpleController" init-method="init" singleton="true">
        <property name="widget">
            <bean class="Screen"/>
        </property>

        <property name="children">
            <list class="ControllerList">
                <ref bean="scrollController" /> 
                <ref bean="tmp1"/>
                <ref bean="rect"/>
                <ref bean="scrollMargins"/>         
            </list>
        </property>

        <!--Nie ma za bardzo jak robić iloczynów logicznych, -->
        <!--wiec trzeba podawać gotowe bit-maski. Pierwszy bit-->
        <!--to mouse move.-->
        <property name="bitMask"><value type="unsigned int">1</value></property>
    </bean>


<!--    <bean id="screenWidth" class="int">-->
<!--        <constructor-arg>-->
<!--            <value type="int">640</value>-->
<!--        </constructor-arg>-->
<!--    </bean>-->

    <!--Konfiguracja-->
    <bean id="cfg" class="BajkaConfig" init-method="init" singleton="true">
        <property name="fullScreen"><value type="bool">false</value></property>
        <property name="resX"><value type="int">640</value></property>
<!--        <property name="resX" ref="screenWidth" />-->
        <property name="resY"><value type="int">480</value></property>
        <property name="windowCaption" value="Bajka DEMO"/>
    </bean>



    <!--Obiekt app, czyli aplikacja :)-->
    <bean id="app" class="BajkaApp" singleton="true">
        <property name="config" ref="cfg" />
        <property name="rootController" ref="screen"/>

        <!--Dispatcher-y eventów. Generują evenyt. Przekształcają eventy -->
        <!--SDL (lub innej biblioteki) na wewnętrzne eventy.-->
        <property name="dispatchers">
            <list class="DispatcherList">
                <bean class="TimerDispatcher" singleton="true">
                    <property name="observers">
                        <list class="ObserverVector">
                            <ref bean="screen" />
<!--                            <ref bean="ruchJednostajny"/>-->
                            <ref bean="scrollController" />
                        </list>
                    </property>
                    <property name="tickInterval"><value type="int">40</value></property>
                </bean>

                <!--Można dodać więcej inż 1 timer o różnych interwałach.-->
<!--                <bean class="TimerDispatcher" singleton="true">-->
<!--                    <property name="observers">-->
<!--                        <list class="ObserverVector">-->
<!--                            <ref bean="screen" />-->
<!--                        </list>-->
<!--                    </property>-->
<!--                    <property name="tickInterval"><value type="int">2000</value></property>-->
<!--                </bean>-->

                <bean class="EventDispatcher" singleton="true" init-method="init">
                    <property name="observers">
                        <list class="ObserverVector">
                            <ref bean="screen" />
                        </list>
                    </property>
                    <property name="config" ref="cfg" />
                </bean>
            </list>
        </property>
    </bean>
    
</beans>
