<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" 
        "file:///home/iwasz/program/projects/tiliae/base/container/tiliae-container-1.0.dtd">

<!--Ogólny schemat nazw : Ctr - kontroler, Wgt - widget, Mdl - model.-->
<beans>

<!-- +===================================================================================+ -->
<!-- | Biblioteka beanów Bajki                                                           | -->
<!-- +===================================================================================+ -->

    <!-- Widget obrazka od razu z modelem. -->
    <bean id="imageWgt" class="View::Image" abstract="true">
        <property name="model" ref="model">
            <bean id="model" class="Model::Image" scope="bean"/>
        </property>
    </bean>

    <!--Definicja obrazka. Jest tu M, V i C, gotowe do użycia. Z tej-->
    <!--definicji należy dziedziczyć (parent) i ustawiać model.path i-->
    <!--na przykłąd model.translatePont.-->
    <bean id="imageCtr" class="SimpleController" init-method="init" abstract="true">
        <!--Model ustawia się z imageWgt -->
        <!--View-->
        <property name="widget" ref="imageWgt"/>
        
        <!-- Domyślnie obrazek nie przyjmuje żadnych eventów -->
        <property name="bitMask"><value type="unsigned int">0</value></property>
    </bean>

<!-- ===================================================================================== -->

    <!-- Widget prostokąta z modelem. -->
    <bean id="rectWgt" class="Rectangle" abstract="true">
        <property name="model" ref="model">
            <bean id="model" class="Model::Box" scope="bean"/>
        </property>
    </bean>
    
    <!-- Kontroler prostokąta z modelem. -->
    <bean id="rectCtr" class="SimpleController" init-method="init" abstract="true">
        <!--Model ustawia się z imageWgt -->
        <!--View-->
        <property name="widget" ref="rectWgt"/>
        
        <!-- Domyślnie obrazek nie przyjmuje żadnych eventów -->
        <property name="bitMask"><value type="unsigned int">0</value></property>
    </bean>



<!-- ===================================================================================== -->
<!--+==============+-->
<!--| Scroll Layer |-->
<!--+==============+-->



    <bean id="scrollEventMargin" class="ScrollMarginController" init-method="init">

        <!--Model-->
        <property name="model">
            <bean class="Model::Box"/>
        </property>

        <!--View-->
        <property name="widget">
            <bean class="Rectangle"/>
        </property>

        <!--Tylko event mouse motion-->
        <property name="bitMask"><value type="unsigned int">1</value></property>       
    </bean>



    <bean id="scrollEventMarginLeft" parent="scrollEventMargin">
        <property name="model.x1"><value type="double">-319</value></property>
        <property name="model.y1"><value type="double">-239</value></property>
        <property name="model.x2"><value type="double">-220</value></property>
        <property name="model.y2"><value type="double">240</value></property>
        <property name="type"><value type="int">3</value></property>
    </bean>



    <bean id="scrollEventMarginRight" parent="scrollEventMargin">
        <property name="model.x1"><value type="double">220</value></property>
        <property name="model.y1"><value type="double">-239</value></property>
        <property name="model.x2"><value type="double">320</value></property>
        <property name="model.y2"><value type="double">240</value></property>
        <property name="type"><value type="int">1</value></property>
    </bean>



    <bean id="scrollEventMarginTop" parent="scrollEventMargin">
        <property name="model.x1"><value type="double">-319</value></property>
        <property name="model.y1"><value type="double">140</value></property>
        <property name="model.x2"><value type="double">320</value></property>
        <property name="model.y2"><value type="double">240</value></property>
        <property name="type"><value type="int">0</value></property>
    </bean>
    
    
    
    <bean id="scrollEventMarginBottom" parent="scrollEventMargin">
        <property name="model.x1"><value type="double">-319</value></property>
        <property name="model.y1"><value type="double">-239</value></property>
        <property name="model.x2"><value type="double">320</value></property>
        <property name="model.y2"><value type="double">-140</value></property>
        <property name="type"><value type="int">2</value></property>
    </bean>



    <bean id="scrollMargins" class="SimpleController" init-method="init" singleton="true">
        <property name="children">
            <list class="ControllerCollection">
                <ref bean="scrollEventMarginLeft"/>                
                <ref bean="scrollEventMarginRight"/>                
                <ref bean="scrollEventMarginTop"/>
                <ref bean="scrollEventMarginBottom"/>
            </list>
        </property>

        <!--Mouse move - jeśli tego nie będzie, to event nie zostanie przekazany do potomków.-->
        <property name="bitMask"><value type="unsigned int">1</value></property>
    </bean>
    
    
    
    <bean id="scrollController" class="ScrollController">
        <property name="model">
            <bean class="ParalaxModel">
                <property name="depths">
                    <list class="DoubleVector">
                        <value type="double">0.5</value>
                        <value type="double">1.0</value>
                    </list>
                </property>
            </bean>
        </property>
    
        <property name="children">
            <list class="ControllerCollection">
                <ref bean="background2"/>
                <ref bean="background"/>
            </list>
        </property>
    
        <!-- Zegarowy -->
        <property name="bitMask"><value type="unsigned int">8</value></property>
    </bean>
    
<!-- ===================================================================================== -->
<!--+===============+-->
<!--| Paralax stuff |-->
<!--+===============+-->
    
    <bean id="modeltmp1" class="Model::Box" scope="singleton">
        <property name="x1"><value type="double">-50</value></property>
        <property name="y1"><value type="double">-50</value></property>
        <property name="x2"><value type="double">50</value></property>
        <property name="y2"><value type="double">50</value></property>
    </bean>
    
    <bean id="tmp1" class="SimpleController" init-method="init">
        <!--Model-->
        <property name="model" ref="modeltmp1"/>

        <!--View-->
        <property name="widget">
            <bean class="Rectangle">
                <property name="model" ref="modeltmp1"/>
            </bean>
        </property>
    </bean>
    
    
    

    
        
    <bean id="translationMapping" class="TranslationMapping">    
        <property name="model" ref="modeltmp1"/>
<!--        <property name="model" ref="paralaxModel"/>-->
<!--        Tak się nie da, a było by miło... -->
<!--        <property name="model" ref="background.model"/> -->

        <property name="sequence">
            <bean id="seq2" class="ConstSequence&lt;Geometry::Point&gt;">
                <property name="step">
                    <bean class="Point">
                        <property name="x"><value type="double">1</value></property>
                        <property name="y"><value type="double">0</value></property>            
                    </bean>
                </property>
            </bean>
        </property>                
    </bean>
    
    <bean id="ruchJednostajny" class="ObserverWithMapping">
        <property name="mapping" ref="translationMapping" />
        <property name="bitMask"><value type="unsigned int">255</value></property>
    </bean>
    
<!-- ===================================================================================== -->

    <bean id="background" parent="imageCtr" singleton="true">
    
        <property name="model.path" value="../gfx/main02.png" />
<!--                <property name="move">-->
<!--                    <bean class="Point">-->
<!--                        <property name="x"><value type="double">-512.0</value></property>-->
<!--                        <property name="y"><value type="double">-512.0</value></property>-->
<!--                    </bean>-->
<!--                </property>-->
    
        <property name="model.resizeW"><value type="double">1</value></property>
        <property name="model.resizeH"><value type="double">1</value></property>
    </bean>

    <bean id="background2" parent="imageCtr" singleton="true">
        <property name="model.path" value="../gfx/ralervegen.jpg" />
<!--        <property name="model.resizeW"><value type="double">2</value></property>-->
<!--        <property name="model.resizeH"><value type="double">2</value></property>-->
    </bean>






    <bean id="buttonWidget" class="StatefulWidget" abstract="true">
        <property name="widgets">
            <map class="StringWidgetMap">
                <entry key="normal">
                    <bean parent="imageWgt"/>
                </entry>

                <entry key="hover">
                    <bean parent="imageWgt"/>
                </entry>

                <entry key="clicked">
                    <bean parent="imageWgt"/>
                </entry>
            </map>
        </property>

        <property name="model">
            <bean id="model" class="Model::Box" scope="bean"/>
        </property>

        <property name="currentWidget" value="normal" />  
    </bean>



    <bean id="button" class="ButtonController" init-method="init">
        <property name="widget">
            <bean parent="buttonWidget"/>
        </property>

        <!-- Model pobiera się sam z widgeta jeśliw widgecie już jest. -->
        <property name="bitMask"><value type="unsigned int">255</value></property>        
    </bean>



    <!--Tak będzie wyglądał guzik w XMLu. Jego rozmiar jest ustalony -->
    <!--przez rozmiar obrazków składających się na 3 stany guzika. -->
    <bean id="myButton" parent="button">
        <property name="widget.widgets.normal.model.path" value="../gfx/button-01-normal.png" />
        <property name="widget.widgets.hover.model.path" value="../gfx/button-01-hover.png" />
        <property name="widget.widgets.clicked.model.path" value="../gfx/button-01-clicked.png" />
    </bean>

<!-- ===================================================================================== -->


    <!-- Test obrazka. -->
    <bean id="pointer01" parent="imageCtr">    
        <property name="model.path" value="../gfx/pointer128.png" />
        <property name="model.move">
            <bean class="Point">
                <property name="x"><value type="double">-320.0</value></property>
                <property name="y"><value type="double">-240.0</value></property>
            </bean>
        </property>
        
        <property name="model.rotate">
                <value type="double">0.05</value>
        </property>
    </bean>

    <bean id="pointer02" parent="imageCtr">    
        <property name="model.path" value="../gfx/pointer64.png" />
<!--        <property name="model.move">-->
<!--            <bean class="Point">-->
<!--                <property name="x"><value type="double">-250.0</value></property>-->
<!--                <property name="y"><value type="double">-240.0</value></property>-->
<!--            </bean>-->
<!--        </property>-->
    </bean>

    <bean id="pointer03" parent="imageCtr">    
        <property name="model.path" value="../gfx/pointer32.png" />
        <property name="model.move">
            <bean class="Point">
                <property name="x"><value type="double">-200.0</value></property>
                <property name="y"><value type="double">-240.0</value></property>
            </bean>
        </property>
    </bean>

    <!-- Test prostokąta. Ma podany rozmiar, przesunięty o 5,5 i odchylony od pionu. -->
    <bean id="myRect" parent="rectCtr">
        <property name="model.x1"><value type="double">-319</value></property>
        <property name="model.y1"><value type="double">-239</value></property>
        <property name="model.x2"><value type="double">-220</value></property>
        <property name="model.y2"><value type="double">240</value></property>        

        <property name="model.rotate">
                <value type="double">0.01</value>
        </property>

        <property name="model.move">
            <bean class="Point">
                <property name="x"><value type="double">5</value></property>
                <property name="y"><value type="double">5</value></property>
            </bean>
        </property>
    </bean>


<!-- ===================================================================================== -->
    
    <bean id="tableWgt" class="EmptyWidget" abstract="true">
        <property name="model">
            <bean id="model" scope="bean" class="Table"/>
        </property>
    </bean>

    <bean id="tableCtr" class="SimpleController" abstract="true" init-method="init">
        <property name="model">
            <bean class="Table"/>
        </property>
        
        <property name="widget">
            <!-- Dzięki temu widać obrys tabeli -->
            <bean class="Rectangle"/>
<!--            <bean class="EmptyWidget"/>-->
        </property>
    </bean>



    <bean id="myTable" parent="tableCtr">
        <property name="model.columnNo"><value type="int">2</value></property>
        <property name="model.rowNo"><value type="int">2</value></property>
<!--        <property name="model.rotate">-->
<!--                <value type="double">0.7</value>-->
<!--        </property>-->

        <property name="children">
            <list class="ControllerCollection">
                <ref bean="pointer02" />
                <ref bean="pointer02" />
                <ref bean="pointer02" />
                <ref bean="pointer02" />
            </list>
        </property>
    </bean>




    <bean id="rectButton" parent="button">
        <property name="widget.widgets.normal.model.path" value="../gfx/bajka/button-rect-normal.png" />
        <property name="widget.widgets.hover.model.path" value="../gfx/bajka/button-rect-hover.png" />
        <property name="widget.widgets.clicked.model.path" value="../gfx/bajka/button-rect-clicked.png" />
    </bean>

    <bean id="circleButton" parent="button">
        <property name="widget.widgets.normal.model.path" value="../gfx/bajka/button-circle-normal.png" />
        <property name="widget.widgets.hover.model.path" value="../gfx/bajka/button-circle-hover.png" />
        <property name="widget.widgets.clicked.model.path" value="../gfx/bajka/button-circle-clicked.png" />
    </bean>

    <bean id="lineButton" parent="button">
        <property name="widget.widgets.normal.model.path" value="../gfx/bajka/button-line-normal.png" />
        <property name="widget.widgets.hover.model.path" value="../gfx/bajka/button-line-hover.png" />
        <property name="widget.widgets.clicked.model.path" value="../gfx/bajka/button-line-clicked.png" />
    </bean>

    <bean id="buttonsTable" parent="tableCtr">
        <property name="model.columnNo"><value type="int">3</value></property>
        <property name="model.rowNo"><value type="int">3</value></property>
        <property name="model.move">
            <bean class="Point">
                <property name="x"><value type="double">250</value></property>
                <property name="y"><value type="double">0</value></property>
            </bean>
        </property>

        <property name="children">
            <list class="ControllerCollection">
                <ref bean="rectButton" />
                <ref bean="circleButton" />
                <ref bean="lineButton" />
            </list>
        </property>

        <property name="bitMask"><value type="unsigned int">255</value></property>
    </bean>



    <bean id="layerCtr" class="SimpleController" init-method="init" abstract="true">
        <property name="model">
            <bean class="Shapeless"/>
        </property>
    
        <property name="widget">
            <bean class="EmptyWidget"/>
        </property>
    </bean>

    <bean id="myLayer" parent="layerCtr">
            <property name="children">
            <list class="ControllerCollection">
                <ref bean="pointer01" />
                <ref bean="pointer03" />
            </list>
        </property>
    </bean>

<!-- ===================================================================================== -->

    <bean id="screen" class="SimpleController" init-method="init" singleton="true">
        <property name="widget">
            <bean class="Screen"/>
        </property>

        <property name="children">
            <list class="ControllerCollection">
                <ref bean="scrollController" /> 
                <ref bean="tmp1"/>
                <ref bean="scrollMargins"/>
                <ref bean="myButton" />
                <ref bean="myRect" />
                <ref bean="myTable" />
                <ref bean="myLayer" />
                <ref bean="buttonsTable" />                
                <ref bean="rectButton" />                
            </list>
        </property>

        <!--Nie ma za bardzo jak robić iloczynów logicznych, -->
        <!--wiec trzeba podawać gotowe bit-maski. Pierwszy bit-->
        <!--to mouse move.-->
        <property name="bitMask"><value type="unsigned int">255</value></property>
    </bean>


<!--    <bean id="screenWidth" class="int">-->
<!--        <constructor-arg>-->
<!--            <value type="int">640</value>-->
<!--        </constructor-arg>-->
<!--    </bean>-->

    <!--Konfiguracja-->
    <bean id="cfg" class="BajkaConfig" init-method="init" singleton="true">
        <property name="fullScreen"><value type="bool">false</value></property>
        <property name="resX"><value type="int">640</value></property>
<!--        <property name="resX" ref="screenWidth" />-->
        <property name="resY"><value type="int">480</value></property>
        <property name="windowCaption" value="Bajka DEMO"/>
    </bean>



    <!--Obiekt app, czyli aplikacja :)-->
    <bean id="app" class="BajkaApp" singleton="true">
        <property name="config" ref="cfg" />
        <property name="rootController" ref="screen"/>

        <!--Dispatcher-y eventów. Generują evenyt. Przekształcają eventy -->
        <!--SDL (lub innej biblioteki) na wewnętrzne eventy.-->
        <property name="dispatchers">
            <list class="DispatcherList">
                <bean class="TimerDispatcher" singleton="true">
                    <property name="observers">
                        <list class="ObserverVector">
                            <ref bean="screen" />
<!--                            <ref bean="ruchJednostajny"/>-->
<!--                            <ref bean="scrollController" />-->
                        </list>
                    </property>
                    <property name="tickInterval"><value type="int">20</value></property>
                </bean>

                <!--Można dodać więcej inż 1 timer o różnych interwałach.-->
<!--                <bean class="TimerDispatcher" singleton="true">-->
<!--                    <property name="observers">-->
<!--                        <list class="ObserverVector">-->
<!--                            <ref bean="screen" />-->
<!--                        </list>-->
<!--                    </property>-->
<!--                    <property name="tickInterval"><value type="int">2000</value></property>-->
<!--                </bean>-->

                <bean class="EventDispatcher" singleton="true" init-method="init">
                    <property name="observers">
                        <list class="ObserverVector">
                            <ref bean="screen" />
                        </list>
                    </property>
                    <property name="config" ref="cfg" />
                </bean>
            </list>
        </property>
    </bean>
    
</beans>
