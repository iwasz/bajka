<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" 
        "file:///home/iwasz/program/projects/tiliae/base/container/tiliae-container-1.0.dtd">

<!--Ogólny schemat nazw : Ctr - kontroler, Wgt - widget, Mdl - model.-->
<beans>

    <import resource="basic.xml" />
    <import resource="examples/machine-demo/demo-scroll.xml" />
    <import resource="examples/machine-demo/demo-app.xml" />

<!-- ===================================================================================== -->

    <bean id="screen" class="SimpleController" init-method="init" singleton="true">
        <property name="widget">
            <bean class="Screen"/>
        </property>

        <property name="model">
            <bean class="Model::Box"/>
        </property>

        <property name="children">
            <list class="ControllerCollection">
                <ref bean="scrollController" />             
                <ref bean="osdLayerCtr" />
<!--                <bean class="MachineController">-->
<!--                    <property name="model">-->
<!--                        <bean class="Model::Box"/>-->
<!--                    </property>-->
<!--                    <property name="widget">-->
<!--                        <bean class="EmptyWidget"/>-->
<!--                    </property>-->
<!--                </bean>-->
            </list>
        </property>

        <!--Nie ma za bardzo jak robić iloczynów logicznych, -->
        <!--wiec trzeba podawać gotowe bit-maski. Pierwszy bit-->
        <!--to mouse move.-->
        <property name="bitMask"><value type="unsigned int">255</value></property>
    </bean>
    
<!-- ===================================================================================== -->
    
    <bean id="rectButton" parent="buttonCtr">
        <property name="widget.widgets.normal.model.path" value="../gfx/bajka/button-rect-normal.png" />
        <property name="widget.widgets.hover.model.path" value="../gfx/bajka/button-rect-hover.png" />
        <property name="widget.widgets.clicked.model.path" value="../gfx/bajka/button-rect-clicked.png" />
    </bean>

    <bean id="circleButton" parent="buttonCtr">
        <property name="widget.widgets.normal.model.path" value="../gfx/bajka/button-circle-normal.png" />
        <property name="widget.widgets.hover.model.path" value="../gfx/bajka/button-circle-hover.png" />
        <property name="widget.widgets.clicked.model.path" value="../gfx/bajka/button-circle-clicked.png" />
    </bean>

    <bean id="lineButton" parent="buttonCtr">
        <property name="widget.widgets.normal.model.path" value="../gfx/bajka/button-line-normal.png" />
        <property name="widget.widgets.hover.model.path" value="../gfx/bajka/button-line-hover.png" />
        <property name="widget.widgets.clicked.model.path" value="../gfx/bajka/button-line-clicked.png" />
    </bean>



    <bean id="buttonTable" parent="tableCtr">
        <property name="model.columnNo"><value type="int">1</value></property>
        <property name="model.rowNo"><value type="int">3</value></property>
<!--        <property name="model.alwaysUpdate"><value type="bool">true</value></property>        -->

        <property name="model.move">
            <bean class="Point">
                <property name="x"><value type="double">266.0</value></property>
                <property name="y"><value type="double">-81</value></property>
            </bean>
        </property>

        <property name="children">
            <list class="ControllerCollection">
                <ref bean="rectButton" />
                <ref bean="circleButton" />
                <ref bean="lineButton" />
            </list>
        </property>
    </bean>
    
    <!-- Warstwa na rożniste napisy, guziki i inne takie. -->
    <bean id="osdLayerCtr" parent="layerCtr">
            <property name="children">
            <list class="ControllerCollection">
                <ref bean="scrollMargins"/>
                <ref bean="buttonTable" />
            </list>
        </property>
    </bean>
        
<!-- ===================================================================================== -->

    <!-- Prosty stan z jednym przejściem -->
    <bean id="simpleState1" class="State" singleton="true" abstract="true">
        <property name="transitions">
            <list class="TransitionList">
                <bean class="Transition">
                    <property name="condition">
                        <bean class="K202Condition"/>
                    </property>
                </bean>
            </list>
        </property>        
    </bean>

    <!-- Prosty stan z dwoma przejściami -->
    <bean id="simpleState2" class="State" singleton="true" abstract="true">
        <property name="transitions">
            <list class="TransitionList">
                <bean class="Transition">
                    <property name="condition">
                        <bean class="K202Condition"/>
                    </property>
                </bean>
                <bean class="Transition">
                    <property name="condition">
                        <bean class="K202Condition"/>
                    </property>
                </bean>
            </list>
        </property>        
    </bean>

<!-- ===================================================================================== -->

    <bean id="machine" class="Machine" singleton="true" init-method="runOnce">
        <constructor-arg>
            <map class="VariantMap">
<!--                TODO Poniższe wyjebuje program! value-ref jest blednym atrybutem--> 
<!--                <entry key="app" value-ref="app" />-->
                <entry key="app" ref="app" />
            </map>
        </constructor-arg>
        <property name="initialStateName" value="menu"/>
        <property name="states">
            <list class="StateList">
                <ref bean="menuState"/>
                <ref bean="level1State"/>
                <ref bean="looseState"/>
                <ref bean="winState"/>
                <ref bean="quitState"/>
            </list>
        </property>        
    </bean>

    <bean id="menuState" class="State" singleton="true">
        <property name="name" value="menu"/>
        <property name="transitions">
            <list class="TransitionList">
                <bean class="Transition">
                    <property name="toState" value="level1"/>
                    <property name="condition">
                        <bean class="K202Condition">
                            <property name="code" value="$!signal == 'play'"/>
                        </bean>
                    </property>
                </bean>
                <bean class="Transition">
                    <property name="toState" value="quit"/>
                    <property name="condition">
                        <bean class="K202Condition">
                            <property name="code" value="$!signal == 'quit'"/>
                        </bean>
                    </property>
                </bean>
            </list>
        </property>        
        <property name="entryActions">
            <list class="ActionList">
                <bean class="K202Action">
                    <property name="code" value="$app.debug ('menuState.entryActions')"/>
                </bean>
            </list>
        </property>
        <property name="exitActions">
            <list class="ActionList">
                <bean class="K202Action">
                    <property name="code" value="$app.debug ('menuState.exitActions')"/>
                </bean>
            </list>
        </property>
    </bean>

<!--    <bean id="level1State" parent="simpleState2">-->
<!--        <property name="name" value="level1"/>-->
<!--        <property name="transitions.0.toState" value="win"/>-->
<!--        <property name="transitions.0.condition.code" value="$!signal == 'play'"/>-->
<!--    </bean>-->


    <bean id="level1State" class="State" singleton="true">
        <property name="name" value="level1"/>
        <property name="transitions">
            <list class="TransitionList">
                <bean class="Transition">
                    <property name="toState" value="win"/>
                    <property name="condition">
                        <bean class="K202Condition">
                            <property name="code" value="$!signal == 'win'"/>
                        </bean>
                    </property>
                </bean>
                <bean class="Transition">
                    <property name="toState" value="loose"/>
                    <property name="condition">
                        <bean class="K202Condition">
                            <property name="code" value="$!signal == 'loose'"/>
                        </bean>
                    </property>
                </bean>
            </list>
        </property>        
        <property name="entryActions">
            <list class="ActionList">
                <bean class="K202Action">
                    <property name="code" value="$app.debug ('level1State.entryActions')"/>
                </bean>
            </list>
        </property>
        <property name="exitActions">
            <list class="ActionList">
                <bean class="K202Action">
                    <property name="code" value="$app.debug ('level1State.exitActions')"/>
                </bean>
            </list>
        </property>
    </bean>

<!-- Nie działa ustawianie transitions.0 -> transitions nie kastuje sie na IList * w ListPlugin-->
<!--    <bean id="looseState" parent="simpleState1">-->
<!--        <property name="name" value="loose"/>-->
<!--        <property name="transitions.0">-->
<!--            <null/>-->
<!--        </property>-->
<!--    </bean>-->

    <bean id="looseState" class="State" singleton="true">
        <property name="name" value="loose"/>
        <property name="transitions">
            <list class="TransitionList">
                <bean class="Transition">
                    <property name="toState" value="menu"/>
                    <property name="condition">
                        <bean class="K202Condition">
                            <property name="code" value="$!signal == 'menu'"/>
                        </bean>
                    </property>
                </bean>
            </list>
        </property>        
        <property name="entryActions">
            <list class="ActionList">
                <bean class="K202Action">
                    <property name="code" value="$app.debug ('looseState.entryActions')"/>
                </bean>
            </list>
        </property>
        <property name="exitActions">
            <list class="ActionList">
                <bean class="K202Action">
                    <property name="code" value="$app.debug ('looseState.exitActions')"/>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="winState" class="State" singleton="true">
        <property name="name" value="win"/>
        <property name="transitions">
            <list class="TransitionList">
                <bean class="Transition">
                    <property name="toState" value="menu"/>
                    <property name="condition">
                        <bean class="K202Condition">
                            <property name="code" value="$!signal == 'menu'"/>
                        </bean>
                    </property>
                </bean>
            </list>
        </property>        
        <property name="entryActions">
            <list class="ActionList">
                <bean class="K202Action">
                    <property name="code" value="$app.debug ('menuState.entryActions')"/>
                </bean>
            </list>
        </property>
        <property name="exitActions">
            <list class="ActionList">
                <bean class="K202Action">
                    <property name="code" value="$app.debug ('menuState.exitActions')"/>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="quitState" class="State" singleton="true">
        <property name="name" value="quit"/>
        <property name="entryActions">
            <list class="ActionList">
                <bean class="K202Action">
                    <property name="code" value="$app.debug ('quitState.entryActions')"/>
                </bean>
            </list>
        </property>
    </bean>

<!-- ===================================================================================== -->

</beans>
