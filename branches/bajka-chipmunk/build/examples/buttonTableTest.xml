<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" 
        "file:///home/iwasz/program/projects/tiliae/base/container/tiliae-container-1.0.dtd">

<!--Ogólny schemat nazw : Ctr - kontroler, Wgt - widget, Mdl - model.-->
<beans>

    <!--Konfiguracja-->
    <bean id="cfg" class="BajkaConfig" init-method="init" singleton="true">
        <property name="fullScreen"><value type="bool">false</value></property>
        <property name="resX"><value type="int">640</value></property>
        <property name="resY"><value type="int">480</value></property>
        <property name="windowCaption" value="Bajka DEMO"/>
    </bean>



    <!--Obiekt app, czyli aplikacja :)-->
    <bean id="app" class="BajkaApp" singleton="true">
        <property name="config" ref="cfg" />
        <property name="rootController" ref="screen"/>

        <!--Dispatcher-y eventów. Generują evenyt. Przekształcają eventy -->
        <!--SDL (lub innej biblioteki) na wewnętrzne eventy.-->
        <property name="dispatchers">
            <list class="DispatcherList">
                <bean class="TimerDispatcher" singleton="true">
                    <property name="observers">
                        <list class="ObserverVector">
                            <ref bean="screen" />
<!--                            <ref bean="ruchJednostajny"/>-->
<!--                            <ref bean="scrollController" />-->
                        </list>
                    </property>
                    <property name="tickInterval"><value type="int">20</value></property>
                </bean>

                <bean class="EventDispatcher" singleton="true" init-method="init">
                    <property name="observers">
                        <list class="ObserverVector">
                            <ref bean="screen" />
                        </list>
                    </property>
                    <property name="config" ref="cfg" />
                </bean>
            </list>
        </property>
    </bean>

<!-- +===================================================================================+ -->
<!-- | Biblioteka beanów Bajki                                                           | -->
<!-- +===================================================================================+ -->

    <!-- Widget obrazka od razu z modelem. -->
    <bean id="imageWgt" class="View::Image" abstract="true">
        <property name="model">
            <bean id="model" class="Model::Image" scope="bean"/>
        </property>
    </bean>

    <!--Definicja obrazka. Jest tu M, V i C, gotowe do użycia. Z tej-->
    <!--definicji należy dziedziczyć (parent) i ustawiać model.path i-->
    <!--na przykłąd model.translatePont.-->
    <bean id="imageCtr" class="SimpleController" init-method="init" abstract="true">
        <!--Model ustawia się z imageWgt -->
        <!--View-->
        <property name="widget" ref="imageWgt"/>
        
        <!-- Domyślnie obrazek nie przyjmuje żadnych eventów -->
        <property name="bitMask"><value type="unsigned int">0</value></property>
    </bean>

<!-- ===================================================================================== -->

    <!-- Widget prostokąta z modelem. -->
    <bean id="rectWgt" class="Rectangle" abstract="true">
        <property name="model">
            <bean id="model" class="Model::Box" scope="bean"/>
        </property>
    </bean>
    
    <!-- Kontroler prostokąta z modelem. -->
    <bean id="rectCtr" class="SimpleController" init-method="init" abstract="true">
        <!--Model ustawia się z imageWgt -->
        <!--View-->
        <property name="widget" ref="rectWgt"/>
        
        <!-- Domyślnie obrazek nie przyjmuje żadnych eventów -->
        <property name="bitMask"><value type="unsigned int">0</value></property>
    </bean>

<!-- ===================================================================================== -->

    <bean id="tableWgt" class="EmptyWidget" abstract="true">
        <property name="model">
            <bean id="model" scope="bean" class="Table"/>
        </property>
    </bean>

    <bean id="tableCtr" class="SimpleController" abstract="true" init-method="init">
        <property name="model">
            <bean class="Table"/>
        </property>
        
        <property name="widget">
            <!-- Dzięki temu widać obrys tabeli, z tym drugim nie. -->
            <bean class="Rectangle"/>
<!--            <bean class="EmptyWidget"/>-->
        </property>
    </bean>

<!-- ===================================================================================== -->

    <bean id="buttonWgt" class="StatefulWidget" abstract="true">
        <property name="widgets">
            <map class="StringWidgetMap">
                <entry key="normal">
                    <bean parent="imageWgt"/>
                </entry>

                <entry key="hover">
                    <bean parent="imageWgt"/>
                </entry>

                <entry key="clicked">
                    <bean parent="imageWgt"/>
                </entry>
            </map>
        </property>

        <property name="model">
            <bean id="model" class="Model::Box" scope="bean"/>
        </property>

        <property name="currentWidget" value="normal" />  
    </bean>



    <bean id="buttonCtr" class="ButtonController" init-method="init">
        <property name="widget">
            <bean parent="buttonWgt"/>
        </property>

        <!-- Model pobiera się sam z widgeta jeśliw widgecie już jest. -->
        <property name="bitMask"><value type="unsigned int">255</value></property>        
    </bean>

<!-- ===================================================================================== -->

    <!--Tak będzie wyglądał guzik w XMLu. Jego rozmiar jest ustalony -->
    <!--przez rozmiar obrazków składających się na 3 stany guzika. -->
<!--    <bean id="myButton" parent="buttonCtr">-->
<!--        <property name="widget.widgets.normal.model.path" value="../gfx/button-01-normal.png" />-->
<!--        <property name="widget.widgets.hover.model.path" value="../gfx/button-01-hover.png" />-->
<!--        <property name="widget.widgets.clicked.model.path" value="../gfx/button-01-clicked.png" />-->
<!--    </bean>-->


    <!-- Test obrazka. -->
    <bean id="pointer01" parent="imageCtr">    
        <property name="model.path" value="../gfx/pointer128.png" />
        <property name="model.move">
            <bean class="Point">
                <property name="x"><value type="double">-320.0</value></property>
                <property name="y"><value type="double">-240.0</value></property>
            </bean>
        </property>
        
        <property name="model.rotate">
                <value type="double">0.05</value>
        </property>
    </bean>

    <bean id="pointer02" parent="imageCtr">    
        <property name="model.path" value="../gfx/pointer64.png" />
<!--        <property name="model.move">-->
<!--            <bean class="Point">-->
<!--                <property name="x"><value type="double">-250.0</value></property>-->
<!--                <property name="y"><value type="double">-240.0</value></property>-->
<!--            </bean>-->
<!--        </property>-->
    </bean>

    <bean id="pointer03" parent="imageCtr">    
        <property name="model.path" value="../gfx/pointer32.png" />
        <property name="model.move">
            <bean class="Point">
                <property name="x"><value type="double">-200.0</value></property>
                <property name="y"><value type="double">-240.0</value></property>
            </bean>
        </property>
    </bean>


<!-- ===================================================================================== -->
    
    <bean id="myTable" parent="tableCtr">
        <property name="model.columnNo"><value type="int">2</value></property>
        <property name="model.rowNo"><value type="int">2</value></property>

<!--        <property name="model.move" value="200, 0" />-->

        <property name="model.move">
            <bean class="Point">
                <property name="x"><value type="double">220.0</value></property>
                <property name="y"><value type="double">-64</value></property>
            </bean>
        </property>

        <property name="model.rotate">
                <value type="double">30</value>
        </property>

        <property name="children">
            <list class="ControllerCollection">
                <ref bean="pointer02" />
                <ref bean="pointer02" />
                <ref bean="pointer02" />
                <ref bean="pointer02" />
            </list>
        </property>
    </bean>



    <bean id="rectButton" parent="buttonCtr">
        <property name="widget.widgets.normal.model.path" value="../gfx/bajka/button-rect-normal.png" />
        <property name="widget.widgets.hover.model.path" value="../gfx/bajka/button-rect-hover.png" />
        <property name="widget.widgets.clicked.model.path" value="../gfx/bajka/button-rect-clicked.png" />
    </bean>

    <bean id="circleButton" parent="buttonCtr">
        <property name="widget.widgets.normal.model.path" value="../gfx/bajka/button-circle-normal.png" />
        <property name="widget.widgets.hover.model.path" value="../gfx/bajka/button-circle-hover.png" />
        <property name="widget.widgets.clicked.model.path" value="../gfx/bajka/button-circle-clicked.png" />
    </bean>

    <bean id="lineButton" parent="buttonCtr">
        <property name="widget.widgets.normal.model.path" value="../gfx/bajka/button-line-normal.png" />
        <property name="widget.widgets.hover.model.path" value="../gfx/bajka/button-line-hover.png" />
        <property name="widget.widgets.clicked.model.path" value="../gfx/bajka/button-line-clicked.png" />
        
<!--        <property name="model.rotate">-->
<!--            <value type="double">30</value>-->
<!--        </property>-->
    </bean>



    <bean id="buttonTable" parent="tableCtr">
        <property name="model.columnNo"><value type="int">1</value></property>
        <property name="model.rowNo"><value type="int">3</value></property>

<!--        <property name="model.move">-->
<!--            <bean class="Point">-->
<!--                <property name="x"><value type="double">-200.0</value></property>-->
<!--                <property name="y"><value type="double">-64</value></property>-->
<!--            </bean>-->
<!--        </property>-->
<!---->
<!--        <property name="model.rotate">-->
<!--                <value type="double">30</value>-->
<!--        </property>-->

        <property name="children">
            <list class="ControllerCollection">
                <ref bean="rectButton" />
                <ref bean="circleButton" />
                <ref bean="lineButton" />
            </list>
        </property>
    </bean>
    
<!-- ===================================================================================== -->

    <bean id="screen" class="SimpleController" init-method="init" singleton="true">
        <property name="widget">
            <bean class="Screen"/>
        </property>

        <property name="children">
            <list class="ControllerCollection">
                <ref bean="myTable" />
                <ref bean="buttonTable" />
            </list>
        </property>

        <!--Nie ma za bardzo jak robić iloczynów logicznych, -->
        <!--wiec trzeba podawać gotowe bit-maski. Pierwszy bit-->
        <!--to mouse move.-->
        <property name="bitMask"><value type="unsigned int">255</value></property>
    </bean>
    
</beans>
