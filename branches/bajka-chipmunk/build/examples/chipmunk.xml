<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" 
        "file:///home/iwasz/program/projects/tiliae/base/container/tiliae-container-1.0.dtd">

<!--Ogólny schemat nazw : Ctr - kontroler, Wgt - widget, Mdl - model.-->
<beans>

    <!--Konfiguracja-->
    <bean id="cfg" class="BajkaConfig" init-method="init" singleton="true">
        <property name="fullScreen" value="false"/>
        <property name="resX" value="640"/>
        <property name="resY" value="480"/>
        <property name="windowCaption" value="Chipmunk tests"/>
    </bean>

    <!--Obiekt app, czyli aplikacja :)-->
    <bean id="app" class="BajkaApp" singleton="true">
        <property name="config" ref="cfg" />
        
        <property name="dispatchers">
            <list class="DispatcherList">
                <bean class="EventDispatcher" singleton="true" init-method="init">
                    <property name="config" ref="cfg" />
                </bean>
            </list>
        </property>
        
        <property name="model" ref="space" />
    </bean>
      
    <bean id="emptyCtr" class="DebugController" singleton="true">
         <property name="eventMask" value="0xffff"/> 
    </bean>      
      
    <bean id="randomColor" class="Color" singleton="false">
        <constructor-arg><value type="bool">true</value></constructor-arg>
    </bean>
      
    <bean id="circleWgt" class="View::Circle" singleton="true">
        <property name="foreground" value="000000FF"/>
        <!-- TODO Wszystkie latajce obiekty maja ten sam kolor, mimo, ze on ma scope prototype. Czemu? -->
        <property name="background" ref="randomColor"/>
    </bean>  

    <bean id="rectangleWgt" class="Rectangle" singleton="true">
        <property name="foreground" value="000000FF"/>
        <property name="background" ref="randomColor"/>
    </bean>  
      
    <bean id="space" class="Space" singleton="true">
	<property name="gravity" value="0, -100"/>
        
        <property name="children">
            <list class="ModelVector">
                <ref bean="boxB"/>
                <ref bean="boxB3"/>                
                <ref bean="boxB4"/>                
                <ref bean="boxB5"/>
                <!--<ref bean="boxB2"/>-->
                <ref bean="body"/>
                <ref bean="ground"/>
                <ref bean="ground2"/>
                <ref bean="ground3"/>
                <ref bean="c2"/>
                <ref bean="c3"/>
                <ref bean="imageBdy"/>
                <ref bean="textBdy"/>
            </list>
        </property>

        <!--<property name="controller" ref="emptyCtr"/>-->
    </bean>
      
    <bean id="body" class="Body" singleton="true">
        <property name="mass" value="1" />
        <property name="position" value="5, 0"/>

        <property name="children">
            <list class="ModelVector">
                <ref bean="circle"/>
            </list>
        </property>
    </bean>      

    <bean id="circle" class="Model::Circle" singleton="true">
        <property name="view" ref="circleWgt"/>            
        <property name="radius" value="50" />    
        <property name="controller" ref="emptyCtr"/>            
    </bean>
    
    <bean id="ground" class="StaticBody" singleton="true">
        <constructor-arg><value type="bool">true</value></constructor-arg>
        <property name="position" value="-320, -240"/>
    
        <property name="children">
            <list class="ModelVector">
<!--                 TODO kiedy tu nie jest singleton="true", to segf! To jakas lipa! -->
<!--                 Uwaga! To dla tego, ze kontener tworzy Ptr <Widget>, ale tam jest Widget *.  -->
<!--                 To się konwertuje ładnie, ale tamten Ptr się kasuje! Zaś gdy damy singleton,-->
<!--                 To Ptr siedzi w pamięci. -->
                <bean class="Model::Box" singleton="true">
                    <property name="width" value="640" />
                    <property name="height" value="10" />
                    <property name="view" ref="rectangleWgt"/>
                </bean>
            </list>
        </property>
    </bean>      

    <bean id="ground2" class="StaticBody" singleton="true">
        <constructor-arg><value type="bool">false</value></constructor-arg>
        <property name="position" value="-320, -240"/>
    
        <property name="children">
            <list class="ModelVector">
                <bean class="Model::Box" singleton="true">
                    <property name="width" value="10" />
                    <property name="height" value="480" />
                    <property name="view" ref="rectangleWgt"/>
                </bean>
            </list>
        </property>
    </bean>   

    <bean id="ground3" class="StaticBody" singleton="true">
        <constructor-arg><value type="bool">false</value></constructor-arg>
        <property name="position" value="310, -240"/>
    
        <property name="children">
            <list class="ModelVector">
                <bean class="Model::Box" singleton="true">
                    <property name="width" value="10" />
                    <property name="height" value="480" />
                    <property name="view" ref="rectangleWgt"/>
                </bean>
            </list>
        </property>
    </bean>   

    <bean id="c2" class="Body" singleton="true">
        <propery name="mass" value="1"/>
        <property name="position" value="-100, 50"/>

        <property name="children">
            <list class="ModelVector">
                <bean id="circle" class="Model::Circle" singleton="true">
                    <property name="view" ref="circleWgt"/>            
                    <property name="radius" value="30" />
                    <property name="controller" ref="emptyCtr"/>    
                </bean>
            </list>
        </property>
    </bean>      
    
    
    
    <bean id="c3" parent="c2">
        <property name="position" value="-150, 50"/>
<!-- TODO to nie dziala, a powinno! -->
<!--        <property name="children.0.radius" value="100"/> -->
    </bean>
    
    
    <bean id="image1Wgt" class="View::Image" singleton="true">
        <property name="path" value="gfx/1.png"/>
    </bean>
    
    <bean id="imageBdy" class="Body" singleton="true">
        <propery name="mass" value="1"/>
        <property name="position" value="70, 50"/>

        <property name="children">
            <list class="ModelVector">
                <bean class="Model::Box" singleton="true">
                    <property name="width" value="92" />
                    <property name="height" value="122" />
                    <property name="view" ref="image1Wgt"/>            
                </bean>
            </list>
        </property>
    </bean>      
    
    <!-- Tak bym chciał, ale to wymaga: 1 fixu i 2 CRów... Czy warto? -->
    <!-- 
    <bean id="img2" parent="imageBody">
        <property name="position" value="70, 50"/>
        <property name="path" value="gfx/1.png"/>
    </bean>
     -->
    
    <bean id="font" class="TTFFont" singleton="true">
        <constructor-arg><value type="text">gfx/volter.ttf</value></constructor-arg>    
    </bean>

    <bean id="textWgt" class="Text" singleton="true">
        <property name="text" value="Hello World!!!"/>
        <property name="font" ref="font"/>        
    </bean>

    <bean id="textBdy" class="Body" singleton="true">
        <propery name="mass" value="1"/>
        <property name="position" value="-70, 200"/>

        <property name="children">
            <list class="ModelVector">
                <bean class="Model::Box" singleton="true">
                    <property name="width" value="200" />
                    <property name="height" value="50" />
                    <property name="view" ref="textWgt"/>            
                </bean>
            </list>
        </property>
    </bean>
         
         
<!--     <bean id="boxB" class="BoxB" singleton="true"> -->
<!--         <property name="box" value="100, 100, 150, 150"/> -->
<!--         <property name="center" value="125, 125"/> -->
<!--         <property name="position" value="20, 20"/>         -->
<!--         <property name="angle" value="45"/> -->
<!--         <property name="scale" value="1"/> -->
<!--         <property name="view" ref="rectangleWgt"/> -->
<!--     </bean>          -->

     <bean id="boxB" class="BoxB" singleton="true">
        <property name="box" value="-20, -20, 20, 20"/>
        <property name="center" value="-20, -20"/>
        <property name="position" value="40, 40"/>        
        <property name="angle" value="45"/>
        <property name="scale" value="2"/>
        <property name="view" ref="rectangleWgt"/>
    </bean>         

      <bean id="boxB3" class="BoxB" singleton="true">
        <property name="box" value="-20, -20, 20, 20"/>
        <property name="center" value="0, 0"/>
<!--         <property name="position" value="20, 20"/>         -->
        <property name="angle" value="45"/>
        <property name="scale" value="1"/>
        <property name="view" ref="rectangleWgt"/>
    </bean>         
     
    <bean id="boxB4" class="BoxB" singleton="true">
        <property name="box" value="-20, -20, 20, 20"/>
        <property name="view" ref="rectangleWgt"/>
    </bean>
                 
<!--                 
    <bean id="boxB2" class="BoxB" singleton="true">
        <property name="box" value="100, 100, 150, 150"/>
        <property name="center" value="125, 125"/>
        <property name="position" value="20, 20"/>        
        <property name="angle" value="30"/>
        <property name="scale" value="1"/>
        <property name="view">
            <bean class="DebugWidget" singleton="true"/>
        </property>
    </bean>       
-->

    <bean id="boxB5" class="BoxB" singleton="true">
        <property name="box" value="100, 100, 150, 150"/>
        <property name="center" value="125, 125"/>
        <property name="position" value="20, 20"/>        
        <property name="angle" value="30"/>
        <property name="scale" value="2"/>
        <property name="view" ref="rectangleWgt"/>
        <property name="controller" ref="emptyCtr"/>    
    </bean>

</beans>
